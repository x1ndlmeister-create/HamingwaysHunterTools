-- HamingwaysHunterTools_PetFood.lua
-- Pet Food Item ID Database (from FeedOMatic addon)

-- Pet Food Item IDs by diet type
-- Source: https://github.com/Monteo/GFW_FeedOMatic
HHT_PET_FOODS = {
    -- Fungus
    fungus = {
        4607, -- Delicious Cave Mold
        8948, -- Dried King Bolete
        4604, -- Forest Mushroom Cap
        4608, -- Raw Black Truffle
        4605, -- Red-speckled Mushroom
        3448, -- Senggin Root
        4606, -- Spongy Morel
    },
    
    -- Fish
    fish = {
        13889, -- Raw Whitescale Salmon
        19996, -- Harvest Fish
        13933, -- Lobster Stew
        13888, -- Darkclaw Lobster
        13935, -- Baked Salmon
        13546, -- Bloodbelly Fish
        6290, -- Brilliant Smallfish
        4593, -- Bristle Whisker Catfish
        5503, -- Clam Meat
        16971, -- Clamlette Surprise
        2682, -- Cooked Crab Claw
        13927, -- Cooked Glossy Mightfish
        2675, -- Crawler Claw
        13930, -- Filet of Redgill
        5476, -- Fillet of Frenzy
        4655, -- Giant Clam Meat
        6038, -- Giant Clam Scorcho
        13928, -- Grilled Squid
        13929, -- Hot Smoked Bass
        13893, -- Large Raw Mightfish
        4592, -- Longjaw Mud Snapper
        8364, -- Mithril Head Trout
        13932, -- Poached Sunscale Salmon
        5095, -- Rainbow Fin Albacore
        6291, -- Raw Brilliant Smallfish
        6308, -- Raw Bristle Whisker Catfish
        13754, -- Raw Glossy Mightfish
        6317, -- Raw Loch Frenzy
        6289, -- Raw Longjaw Mud Snapper
        8365, -- Raw Mithril Head Trout
        6361, -- Raw Rainbow Fin Albacore
        13758, -- Raw Redgill
        6362, -- Raw Rockscale Cod
        6303, -- Raw Slitherskin Mackerel
        8959, -- Raw Spinefin Halibut
        4603, -- Raw Spotted Yellowtail
        13756, -- Raw Summer Bass
        13760, -- Raw Sunscale Salmon
        4594, -- Rockscale Cod
        787, -- Slitherskin Mackerel
        5468, -- Soft Frenzy Flesh
        15924, -- Soft-shelled Clam Meat
        12216, -- Spiced Chili Crab
        8957, -- Spinefin Halibut
        6887, -- Spotted Yellowtail
        5504, -- Tangy Clam Meat
        12206, -- Tender Crab Meat
        13755, -- Winter Squid
        7974, -- Zesty Clam Meat
    },
    
    -- Meat
    meat = {
        21235, -- Winter Veil Roast
        19995, -- Harvest Boar
        4457, -- Barbecued Buzzard Wing
        3173, -- Bear Meat
        2888, -- Beer Basted Boar Ribs
        3730, -- Big Bear Meat
        3726, -- Big Bear Steak
        3220, -- Blood Sausage
        2677, -- Boar Ribs
        3404, -- Buzzard Wing
        12213, -- Carrion Surprise
        2679, -- Charred Wolf Meat
        769, -- Chunk of Boar Meat
        2673, -- Coyote Meat
        2684, -- Coyote Steak
        1081, -- Crisp Spider Meat
        12224, -- Crispy Bat Wing
        5479, -- Crispy Lizard Tail
        2924, -- Crocolisk Meat
        3662, -- Crocolisk Steak
        4599, -- Cured Ham Steak
        17119, -- Deeprun Rat Kabob
        5478, -- Dig Rat Stew
        5051, -- Dig Rat
        12217, -- Dragonbreath Chili
        2687, -- Dry Pork Ribs
        9681, -- Grilled King Crawler Legs
        2287, -- Haunch of Meat
        12204, -- Heavy Kodo Meat
        3727, -- Hot Lion Chops
        13851, -- Hot Wolf Ribs
        12212, -- Jungle Stew
        5472, -- Kaldorei Spider Kabob
        5467, -- Kodo Meat
        5480, -- Lean Venison
        1015, -- Lean Wolf Flank
        12209, -- Lean Wolf Steak
        3731, -- Lion Meat
        12223, -- Meaty Bat Wing
        3770, -- Mutton Chop
        12037, -- Mystery Meat
        4739, -- Plainstrider Meat
        12184, -- Raptor Flesh
        13759, -- Raw Nightfin Snapper
        12203, -- Red Wolf Meat
        12210, -- Roast Raptor
        2681, -- Roasted Boar Meat
        5474, -- Roasted Kodo Meat
        8952, -- Roasted Quail
        1017, -- Seasoned Wolf Kabob
        5465, -- Small Spider Leg
        6890, -- Smoked Bear Meat
        3712, -- Smoked Sagefish
        3729, -- Soothing Turtle Bisque
        2680, -- Spiced Wolf Meat
        17222, -- Spider Sausage
        5471, -- Stag Meat
        5469, -- Strider Meat
        5477, -- Strider Stew
        2672, -- Stringy Wolf Meat
        2685, -- Succulent Pork Ribs
        3728, -- Tasty Lion Steak
        3667, -- Tender Crocolisk Meat
        12208, -- Tender Wolf Meat
        18045, -- Tender Wolf Steak
        5470, -- Thunder Lizard Tail
        12202, -- Tiger Meat
        117, -- Tough Jerky
        3712, -- Turtle Meat
        12205, -- White Spider Meat
        3771, -- Wild Hog Shank
    },
    
    -- Bread
    bread = {
        1113, -- Conjured Bread
        5349, -- Conjured Muffin
        1487, -- Conjured Pumpernickel
        1114, -- Conjured Rye
        8075, -- Conjured Sourdough
        8076, -- Conjured Sweet Roll
        22895, -- Conjured Cinnamon Roll
        19696, -- Harvest Bread
        21254, -- Winter Veil Cookie
        2683, -- Crab Cake
        4541, -- Freshly Baked Bread
        17197, -- Gingerbread Cookie
        3666, -- Gooey Spider Cake
        8950, -- Homemade Cherry Pie
        4542, -- Moist Cornbread
        4544, -- Mulgore Spice Bread
        4601, -- Soft Banana Bread
        4540, -- Tough Hunk of Bread
        16169, -- Wild Ricecake
    },
    
    -- Cheese
    cheese = {
        8932, -- Alterac Swiss
        414, -- Dalaran Sharp
        2070, -- Darnassian Bleu
        422, -- Dwarven Mild
        3927, -- Fine Aged Cheddar
        1707, -- Stormwind Brie
    },
    
    -- Fruit
    fruit = {
        19994, -- Harvest Fruit
        8953, -- Deep Fried Plantains
        4539, -- Goldenbark Apple
        16168, -- Heaven Peach
        4602, -- Moon Harvest Pumpkin
        4536, -- Shiny Red Apple
        4538, -- Snapvine Watermelon
        4537, -- Tel'Abim Banana
        11950, -- Windblossom Berries
    },
    
    -- Bonus Foods (provide "well fed" buffs or special effects)
    bonus = {
        2888, -- Beer Basted Boar Ribs
        11584, -- Cactus Apple Surprise
        7807, -- Candy Bar
        7808, -- Chocolate Square
        12224, -- Crispy Bat Wing
        17197, -- Gingerbread Cookie
        6888, -- Herb Baked Egg
        5472, -- Kaldorei Spider Kabob
        7806, -- Lollipop
        5474, -- Roasted Kodo Meat
        2680, -- Spiced Wolf Meat
        3220, -- Blood Sausage
        5525, -- Boiled Clams
        2684, -- Coyote Steak
        2683, -- Crab Cake
        3662, -- Crocolisk Steak
        2687, -- Dry Pork Ribs
        5476, -- Fillet of Frenzy
        724, -- Goretusk Liver Pie
        5477, -- Strider Stew
        3726, -- Big Bear Steak
        5479, -- Crispy Lizard Tail
        3664, -- Crocolisk Gumbo
        3665, -- Curiously Tasty Omelet
        5527, -- Goblin Deviled Clams
        3666, -- Gooey Spider Cake
        3727, -- Hot Lion Chops
        5480, -- Lean Venison
        12209, -- Lean Wolf Steak
        3663, -- Murloc Fin Soup
        1082, -- Redridge Goulash
        1017, -- Seasoned Wolf Kabob
        4457, -- Barbecued Buzzard Wing
        12213, -- Carrion Surprise
        6038, -- Giant Clam Scorcho
        13851, -- Hot Wolf Ribs
        12212, -- Jungle Stew
        12214, -- Mystery Stew
        12210, -- Roast Raptor
        3729, -- Soothing Turtle Bisque
        3728, -- Tasty Lion Steak
        16971, -- Clamlette Surprise
        12215, -- Heavy Kodo Stew
        12218, -- Monster Omelet
        12216, -- Spiced Chili Crab
        17222, -- Spider Sausage
        18045, -- Tender Wolf Steak
        2682, -- Cooked Crab Claw
        3448, -- Senggin Root
        12217, -- Dragonbreath Chili
        13927, -- Cooked Glossy Mightfish
        13928, -- Grilled Squid
        13929, -- Hot Smoked Bass
        13932, -- Poached Sunscale Salmon
        13931, -- Nightfin Soup
        13934, -- Mightfish Steak
        11950, -- Windblossom Berries
        18254, -- Runn Tum Tuber Surprise
    },
}

-- Function to check if an item ID is pet food for current pet
function HHT_IsPetFood(itemID)
    if not itemID then return false end
    if not UnitExists("pet") then return false end
    
    -- Get pet's food types from WoW API
    local foodTypes = {GetPetFoodTypes()}
    if not foodTypes or table.getn(foodTypes) == 0 then return false end
    
    -- Check each food type the pet can eat
    for _, foodType in ipairs(foodTypes) do
        local diet = string.lower(foodType)
        if HHT_PET_FOODS[diet] then
            -- Check if item ID is in this diet's list
            for _, foodID in ipairs(HHT_PET_FOODS[diet]) do
                if foodID == itemID then
                    return true
                end
            end
        end
    end
    
    return false
end

-- Function to find all pet food in bags
function HHT_FindPetFoodInBags()
    if not UnitExists("pet") then return {} end
    local petName = UnitName("pet")
    if petName == "Unknown Entity" or petName == "Unknown" or petName == UNKNOWNOBJECT then
        return {}
    end
    
    local foodList = {}
    local foodCounts = {} -- Track counts by item name
    
    -- Scan all bags (0-4)
    for bag = 0, 4 do
        local numSlots = GetContainerNumSlots(bag)
        if numSlots and numSlots > 0 then
            for slot = 1, numSlots do
                local texture, count = GetContainerItemInfo(bag, slot)
                if texture and count then
                    local itemLink = GetContainerItemLink(bag, slot)
                    if itemLink then
                        -- Extract item ID from link
                        local _, _, itemID = string.find(itemLink, "item:(%d+)")
                        itemID = tonumber(itemID)
                        
                        -- Check if it's pet food using item ID
                        if itemID and HHT_IsPetFood(itemID) then
                            local itemName = GetItemInfo(itemID)
                            if itemName then
                                -- Check if this food is already in the list
                                if foodCounts[itemName] then
                                    -- Add count to existing entry
                                    foodCounts[itemName].count = foodCounts[itemName].count + count
                                else
                                    -- Add new entry
                                    foodCounts[itemName] = {
                                        bag = bag,
                                        slot = slot,
                                        name = itemName,
                                        texture = texture,
                                        count = count
                                    }
                                    table.insert(foodList, foodCounts[itemName])
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    
    return foodList
end
